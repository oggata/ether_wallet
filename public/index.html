<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="robots" content="noindex, nofollow">
    <title>EtherPlanets</title>

	<script>
	    window.onload = function() {
	        var formData = new FormData();
	        var xhr = new XMLHttpRequest();
	        //xhr.timeout=1000;
            var host = window.location.hostname;
            var port = window.location.port;
            var url = "http://" + host + ":" + port + "/api/user/me";
	        xhr.open('GET', url);
            xhr.onreadystatechange = function() {
                switch ( xhr.readyState ) {
                    case 0:
                        // 未初期化状態.
                        console.log( 'uninitialized!' );
                        break;
                    case 1: // データ送信中.
                        console.log( 'loading...' );
                        break;
                    case 2: // 応答待ち.
                        console.log( 'loaded.' );
                        break;
                    case 3: // データ受信中.
                        console.log( 'interactive... '+xhr.responseText.length+' bytes.' );
                        break;
                    case 4: // データ受信完了.
                        if( xhr.status == 200 || xhr.status == 304 ) {
                            var data = xhr.responseText; // responseXML もあり
                            console.log( 'COMPLETE! :'+data );
                        } else {
                            console.log( 'Failed. HttpStatus: '+xhr.statusText );
                        }
                    break;
                }
            }
			xhr.onerror = function (e) {
			     console.log(xhr);
			     console.error(xhr.statusText);
			};
	        xhr.onload = function (e) {
	        	console.log("xhr3");
	        	console.log(this.status);
	            if (this.status == 200) {
	                var json = JSON.parse(this.responseText);
					if(json.status == "logout"){
					    location.href='/login';
					}
					if(json.status == "user_not_found"){
					    location.href='/account';
					}
	                var _walletBalanceLabel = document.getElementById('wallet_balance');
	                _walletBalanceLabel.innerHTML = json.user.wallet_balance.toString();
	                var _coinBalanceLabel = document.getElementById('coin_balance');
	                _coinBalanceLabel.innerHTML = json.user.coin_amount.toString();
                    var _gameScoreLabel = document.getElementById('game_score');
                    _gameScoreLabel.innerHTML = json.user.score.toString();
	                var _walletAddressLabel = document.getElementById('wallet_address');
	                _walletAddressLabel.innerHTML = json.user.wallet_address.toString();
	                var _walletAddressImage = document.getElementById('wallet_address_image');
	                _walletAddressImage.innerHTML = '<img src="http://chart.apis.google.com/chart?chs=200x200&cht=qr&chl=' +json.user.wallet_address.toString() + '" alt="QRコード">'
	            }
	        };
	        xhr.send();
	    }

        function goToGameLayer() {
            var _coinBalanceLabel = document.getElementById('coin_balance');
            if(Number(_coinBalanceLabel.innerHTML) > 1){
                location.href='/html5/index.html';
            }else{
                alert("Coin balance is insufficient.");
            } 
        }

	    function OnButtonClick() {
            console.log("buy");
	        var xhr = new XMLHttpRequest();
	        //xhr.timeout=1000;
            var host = window.location.hostname;
            var port = window.location.port;
            var url = "http://" + host + ":" + port + "/api/user/buy?amount=10";
            xhr.open('GET', url);


            xhr.onreadystatechange = function() {
                
                switch ( xhr.readyState ) {
                    case 0:
                        // 未初期化状態.
                        console.log( 'uninitialized!' );
                        break;
                    case 1: // データ送信中.
                        console.log( 'loading...' );
                        break;
                    case 2: // 応答待ち.
                        console.log( 'loaded.' );
                        break;
                    case 3: // データ受信中.
                        console.log( 'interactive... '+xhr.responseText.length+' bytes.' );
                        break;
                    case 4: // データ受信完了.
                        if( xhr.status == 200 || xhr.status == 304 ) {
                            var data = xhr.responseText; // responseXML もあり
                            console.log( 'COMPLETE! :'+data );
                            var json = JSON.parse(data);
                            alert(json.status);
                            if(json.status == "logout"){
                                location.href='/login';
                                return;
                            }
                            if(json.status == "ok"){
                                location.reload();
                                return;
                            }
                            return;
                        } else {
                            console.log( 'Failed. HttpStatus: '+xhr.statusText );
                            alert("Purchase failed.");
                        }
                        break;
                
                }
            }

			xhr.onerror = function (e) {
			  console.log(xhr);
			  console.error(xhr.statusText);
			};
	        xhr.send();
	    }
	</script>


    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="./bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <style type="text/css">
        .hero-widget { text-align: center; padding-top: 60px; padding-bottom: 100px; height:250px;}
        .hero-widget .icon { display: block; font-size: 96px; line-height: 96px; margin-bottom: 10px; text-align: center; }
        .hero-widget var { display: block; height: 64px; font-size: 64px; line-height: 64px; font-style: normal; }
        .hero-widget label { font-size: 30px; }
        .hero-widget .options { margin-top: 140px; }

        .mt-100 {
            margin-top: 100px; 
        }
        .mb-100 {
            margin-bottom: 100px;
        }

        .icon {
            width: 32px;
            height: 32px;
            text-align: center;
            padding: 7px 8px;
            border: 2px solid;
            border-radius: 50%;
        }

        .header {
            padding-top: 50px;
            background-color: #eee;
            overflow: hidden;
            height:400px;
        }
        .footer {
            color: #887;
            background-color: #eee;
            padding-top: 30px;
            padding-bottom: 30px;
        }

        .content {
            position: relative;
            display: table;
            width: 100%;
            min-height: 100vh;
        }
        .pull-middle {
            display: table-cell;
            vertical-align: middle;
        }

        .btn {
            padding-left: 25px;
            padding-right: 25px;
        }
        .btn-circle {
            border-radius: 20px;
        }

        .input-group input {
            border: 0;
            box-shadow: none;
            padding-right: 30px;
        }
        .input-group input:focus,
        .input-group input:active {
            outline: 0;
            box-shadow: none;
        }
        .input-group-btn:last-child>.btn {
            z-index: 2;
            margin-left: -18px;   
            border-radius: 20px;
        }

        .phone {
            position: relative;
            max-width: 263px;
            margin: 0 auto;
            padding: 65px 15px 55px;
            border: 2px solid #ddd;
            border-radius: 20px;
            background-color: #222;
            box-shadow: 20px 20px 40px #887;
        }
    </style>
</head>
<body>
    <div class="wrapper">
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand text-uppercase" href="#">EtherPlanets<span class="label label-success text-capitalize"></span></a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="navigation">
        </div>
      </div>
    </nav>

    <div class="jumbotron" style="background:url('/images/top.png');background-size:cover;">
      <div class="container">
        <h1 class="display-3">EtherPlanets</h1>
        <p>This is a prototype game using ethereum.</p>
        <p><a class="btn btn-primary btn-lg" href="#" role="button" onclick="goToGameLayer()">Play Game &raquo;</a></p>
      </div>
    </div>

    <div class="wrapper">
	<br />
        <div class="container">
            <div class="row">
                <div class="col-sm-4">
                    <div class="hero-widget well well-sm">

                        <div class="text">
                            <var id="wallet_balance">0
                            </var>
                            <label class="text-muted">Ethereum</label>
                        </div>

                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="hero-widget well well-sm">

                        <div class="text">
                            <var id="coin_balance">0
                            </var>

                            <label class="text-muted">GameCoin</label>
                        </div>

                    </div>
                </div>

                <div class="col-sm-4">
                    <div class="hero-widget well well-sm">

                        <div class="text">
                            <var id="game_score">0
                            </var>

                            <label class="text-muted">Score</label>
                        </div>

                    </div>
                </div>
                
            </div>
        </div>
    </div>
    <div class="wrapper">
			<div class="container">
			<h2 class="form-signin-heading">WalletAddress</h2><hr>
			<small class="text-muted">
                Please send ethereum you want to exchange GameCoin.<br>
                This game is prototype and you can't send ethereum to other address.
			</small>
            <div class="container">
                <form>
                    <div class="form-group">
                        <h5><var id="wallet_address">0</var></h5>
                        <var id="wallet_address_image">0</var>
                    </div>
                </form>
            </div>
    </div>
    <section class="section">
        <div class="container">

			<h2 class="form-signin-heading">BUY GAME COIN</h2>
			<small class="text-muted">
				Please send ethereum you want to exchange game coin.<br>
                This game is prototype and you can't send ethereum that you sent to other address.
			</small>

            <div class="row">
                <br><br><br>
                <!-- Plans -->
                <section id="plans">
                    <div class="container">
                        <div class="row">
                            <!-- item -->
                            <div class="col-md-4 text-center">
                                <div class="panel panel-danger panel-pricing">
                                    <div class="panel-heading">
                                        <i class="fa fa-desktop"></i>
                                        <h3>10COIN</h3>
                                    </div>
                                    <div class="panel-body text-center">
                                        <p><strong>0.001ETH</strong></p>
                                    </div>
                                    <ul class="list-group text-center">
                                        <li class="list-group-item"><i class="fa fa-check"></i> Discount 0 ETH </li>
                                    </ul>
                                    <div class="panel-footer">
                                        <a class="btn btn-lg btn-block btn-danger" onclick="OnButtonClick()">BUY NOW!</a>
                                    </div>
                                </div>
                            </div>
                            <!-- /item -->

                            <!-- item -->
                            <div class="col-md-4 text-center">
                                <div class="panel panel-warning panel-pricing">
                                    <div class="panel-heading">
                                        <i class="fa fa-desktop"></i>
                                        <h3>100COIN</h3>
                                    </div>
                                    <div class="panel-body text-center">
                                        <p><strong>0.01ETH</strong></p>
                                    </div>
                                    <ul class="list-group text-center">
                                        <li class="list-group-item"><i class="fa fa-check"></i> Discount 0 ETH </li>
                                    </ul>
                                    <div class="panel-footer">
                                        <a class="btn btn-lg btn-block btn-warning" onclick="buy002()">BUY NOW!</a>
                                    </div>
                                </div>
                            </div>
                            <!-- /item -->

                            <!-- item -->
                            <div class="col-md-4 text-center">
                                <div class="panel panel-success panel-pricing">
                                    <div class="panel-heading">
                                        <i class="fa fa-desktop"></i>
                                        <h3>1000COIN</h3>
                                    </div>
                                    <div class="panel-body text-center">
                                        <p><strong>0.1ETH</strong></p>
                                    </div>
                                    <ul class="list-group text-center">
                                        <li class="list-group-item"><i class="fa fa-check"></i> Discount 0 ETH </li>
                                    </ul>
                                    <div class="panel-footer">
                                        <a class="btn btn-lg btn-block btn-success" onclick="buy003()">BUY NOW!</a>
                                    </div>
                                </div>
                            </div>
                            <!-- /item -->

                        </div>
                    </div>
                </section>
                <!-- /Plans -->
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container">
            <div class="row">
                <div class="col-md-3 text-right">
                    <div class="content">
                        <div class="pull-middle">
                            <h4><strong>Discover an unknown planet</strong></h4>
                            <p>The planet found by the player is managed as a token and managed on the block chain. You can exchange rare planets you discover with each other.</p>

                        </div>
                    </div>
                </div>
               <div class="col-md-4 col-md-offset-1 mt-100 mb-100">
                    <div class="phone">
                        <img class="img-responsive img-rounded" src="./images/sc1.png">
                    </div>
                </div>
                <div class="col-md-3 col-md-offset-1">
                    <div class="content">
                        <div class="pull-middle">
                            <h4><strong>Looking for farther stars</strong></h4>
                            <p>By playing the game and strengthening the spacecraft, you will be able to explore longer distances. Let's go on a journey to find the planet at the end of the universe
</p>
                            <button class="btn btn-success btn-circle" type="submit" onclick="goToGameLayer()">Play Game</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <footer class="footer text-center">
        <div class="container">
            <small>© Copyright 2017. Crafted with oggata</small>
        </div>
    </footer>
</div>
</body>
</html>
